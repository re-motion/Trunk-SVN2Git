<?xml version="1.0" encoding="UTF-8" ?>
<!-- This file is part of the re-motion Core Framework (www.re-motion.org)
 ! Copyright (C) 2005-2009 rubicon informationstechnologie gmbh, www.rubicon.eu
 ! 
 ! The re-motion Core Framework is free software; you can redistribute it 
 ! and/or modify it under the terms of the GNU Lesser General Public License 
 ! as published by the Free Software Foundation; either version 2.1 of the 
 ! License, or (at your option) any later version.
 ! 
 ! re-motion is distributed in the hope that it will be useful, 
 ! but WITHOUT ANY WARRANTY; without even the implied warranty of 
 ! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the 
 ! GNU Lesser General Public License for more details.
 ! 
 ! You should have received a copy of the GNU Lesser General Public License
 ! along with re-motion; if not, see http://www.gnu.org/licenses.
-->
<Project DefaultTargets="TestBuild" ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Import Project="Remotion.Tasks.include.build" />
  <Import Project="Remotion.Packages.include.build" />
  <Import Project="Remotion.Projects.include.build" />
  <Import Project="Remotion.Configurations.include.build" />
  <Import Project="Remotion.BuildTargets.include.build" />
  <Import Project="Remotion.Documentation.include.build" />
  <Import Project="Remotion.AssembleBuildOutput.include.build" />
  
  <PropertyGroup>
    <Version></Version>
    <CodePlexUsername></CodePlexUsername>
    <CodePlexPassword></CodePlexPassword>
    <SolutionDirectory>$(MSBuildProjectDirectory)\..\</SolutionDirectory>
    <OutputDirectory>$(MSBuildProjectDirectory)\BuildOutput\$(Version)\</OutputDirectory>
    <LogDirectory>$(OutputDirectory)log\</LogDirectory>
    <TempDirectory>$(MSBuildProjectDirectory)\BuildOutput\temp\</TempDirectory>
    <ArchiveDirectory>$(MSBuildProjectDirectory)\BuildOutput\Archive\</ArchiveDirectory>
    <WebShareDirectory>$(MSBuildProjectDirectory)\BuildOutput\WebShare\</WebShareDirectory>
    <SolutionKeyFile>$(SolutionDirectory)remotion.snk</SolutionKeyFile>
    <BinariesDirectory>$(TempDirectory)Binaries\</BinariesDirectory>
  </PropertyGroup>
  
  <PropertyGroup>
    <NUnitToolPath>$(SolutionDirectory)prereq\Tools\NUnit 2.5\bin\net-2.0</NUnitToolPath>
    <NDocToolPath>$(SolutionDirectory)prereq\Tools\NDoc2\</NDocToolPath>
    <MSBuildCommunityTasksPath>$(SolutionDirectory)prereq\Tools\MSBuildCommunityTasks\</MSBuildCommunityTasksPath>
    <MSBuildExtensionPackPath>$(SolutionDirectory)prereq\Tools\MSBuildExtensionPack\</MSBuildExtensionPackPath>
    <RemotionBuildTasksPath>$(SolutionDirectory)prereq\Tools\Remotion.BuildTools.MSBuildTasks\</RemotionBuildTasksPath>
  </PropertyGroup>
  
  <Target Name="BuildAll" DependsOnTargets="CleanFolders;CheckVersion">
    <MSBuild Projects="$(MSBuildProjectFile)"
             BuildInParallel="false"
             Targets="LogConfiguration;CleanProjects;BuildReleaseProjects;BuildTestProjects;RunTests;GeneratePublicDocumentation;AssembleBuildOutput;"
             Properties="ConfigurationID=%(AllConfigurations.Identity);SolutionKeyFile=$(SolutionKeyFile)"/>
  </Target>

  <Target Name="DocumentAll">
    <MSBuild Projects="%(AllPackages.DocumentationDeclaration)"
             BuildInParallel="false"
             Targets="GeneratePublicDocumentation;CopyChmFilesToBinariesDirectory;"
             Properties="SolutionDirectory=$(SolutionDirectory);BinariesDirectory=$(BinariesDirectory);TempDirectory=$(TempDirectory);Version=$(Version);"/>
  </Target>

  <Target Name="PackageAll">
    <MSBuild Projects="%(AllPackages.PackageDeclaration)"
             BuildInParallel="false"
             Targets="CreatePackages"
             Properties="SolutionDirectory=$(SolutionDirectory);BinariesDirectory=$(BinariesDirectory);OutputDirectory=$(OutputDirectory);TempDirectory=$(TempDirectory);Version=$(Version);"/>
  </Target>

  <Target Name="DeployAll">
    <MSBuild Projects="%(AllPackages.PackageDeclaration)"
             BuildInParallel="false"
             Targets="DeployPackages"
             Properties="SolutionDirectory=$(SolutionDirectory);BinariesDirectory=$(BinariesDirectory);OutputDirectory=$(OutputDirectory);TempDirectory=$(TempDirectory);Version=$(Version);ArchiveDirectory=$(ArchiveDirectory);WebShareDirectory=$(WebShareDirectory);CodeplexUserName=$(CodePlexUsername);CodeplexPassword=$(CodePlexPassword)"/>
  </Target>

  <Target Name="FullBuild" DependsOnTargets="BuildAll;PackageAll" />

  <Target Name="TestBuild" DependsOnTargets="CleanFolders" >
    <MSBuild Projects="$(MSBuildProjectFile)"
             BuildInParallel="false"
             Targets="CleanProjects;BuildReleaseProjects;BuildTestProjects;RunTests;AssembleBuildOutput;"
             Properties="ConfigurationID=Debug;SolutionKeyFile=$(SolutionKeyFile)"/>
  </Target>

</Project>