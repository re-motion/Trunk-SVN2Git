<?xml version="1.0" encoding="UTF-8" ?>
<!-- Copyright (C) 2005 - 2008 rubicon informationstechnologie gmbh
 !
 ! This program is free software: you can redistribute it and/or modify it under 
 ! the terms of the re:motion license agreement in license.txt. If you did not 
 ! receive it, please visit http://www.re-motion.org/licensing.
 ! 
 ! Unless otherwise provided, this software is distributed on an "AS IS" basis, 
 ! WITHOUT WARRANTY OF ANY KIND, either express or implied. 
-->

<queries 
    application="Remotion.SecurityManager" 
    xmlns="http://www.re-motion.org/Data/DomainObjects/Queries/1.0" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:schemaLocation="http://www.re-motion.org/Data/DomainObjects/Queries/1.0 ..\..\..\Data\DomainObjects\Schemas\queries.xsd">

  <query id="Remotion.SecurityManager.Domain.Revision.GetRevision" type="scalar">
    <storageProviderID>SecurityManager</storageProviderID>
    <statement>
      SELECT TOP 1 Value FROM [Revision];
    </statement>
  </query>

  <query id="Remotion.SecurityManager.Domain.Revision.IncrementRevision" type="scalar">
    <storageProviderID>SecurityManager</storageProviderID>
    <statement>
      Update [Revision] SET [Value] = [Value] + 1;
    </statement>
  </query>

  <query id="Remotion.SecurityManager.Domain.Metadata.MetadataObject.Find" type="collection">
    <storageProviderID>SecurityManager</storageProviderID>
    <statement>
      SELECT * FROM [MetadataObjectView] WHERE MetadataItemID = @metadataItemID;
    </statement>
  </query>

  <query id="Remotion.SecurityManager.Domain.Metadata.MetadataObject.Find.StateDefinition" type="collection">
    <storageProviderID>SecurityManager</storageProviderID>
    <statement>
      SELECT * FROM StateDefinitionView
      INNER JOIN StatePropertyDefinitionView ON StateDefinitionView.StatePropertyID = StatePropertyDefinitionView.ID
      WHERE StatePropertyDefinitionView.MetadataItemID = @metadataItemID
      AND StateDefinitionView.Value = @stateValue;
    </statement>
  </query>

  <query id="Remotion.SecurityManager.Domain.OrganizationalStructure.User.FindByTenantID" type="collection">
    <storageProviderID>SecurityManager</storageProviderID>
    <statement>
      SELECT * FROM [UserView] WHERE TenantID = @tenantID ORDER BY LastName ASC, FirstName ASC;
    </statement>
  </query>

  <query id="Remotion.SecurityManager.Domain.OrganizationalStructure.Group.FindByUnqiueIdentifier" type="collection">
    <storageProviderID>SecurityManager</storageProviderID>
    <statement>
      SELECT * FROM [GroupView] WHERE [UniqueIdentifier] = @uniqueIdentifier;
    </statement>
  </query>

  <query id="Remotion.SecurityManager.Domain.OrganizationalStructure.Group.FindByTenantID" type="collection">
    <storageProviderID>SecurityManager</storageProviderID>
    <statement>
      SELECT * FROM [GroupView] WHERE TenantID = @tenantID ORDER BY ShortName ASC, Name ASC;
    </statement>
  </query>
  
  <query id="Remotion.SecurityManager.Domain.OrganizationalStructure.GroupType.FindAll" type="collection">
    <storageProviderID>SecurityManager</storageProviderID>
    <statement>
      SELECT * FROM [GroupTypeView] ORDER BY Name ASC;
    </statement>
  </query>
  
  <query id="Remotion.SecurityManager.Domain.OrganizationalStructure.Position.FindAll" type="collection">
    <storageProviderID>SecurityManager</storageProviderID>
    <statement>
      SELECT * FROM [PositionView] ORDER BY Name ASC;
    </statement>
  </query>

  <query id="Remotion.SecurityManager.Domain.Metadata.Culture.Find" type="collection">
    <storageProviderID>SecurityManager</storageProviderID>
    <statement>
      SELECT * FROM [CultureView] WHERE CultureName = @cultureName;
    </statement>
  </query>
</queries>
